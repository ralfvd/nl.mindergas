function Homey(){this._ready=!1,this._origin=void 0,this._cf,this._init()}!function(){function t(t,o){return this._opts=o||{},"number"!=typeof this._opts.delay&&(this._opts.delay=50),this.onMessage=this.onMessage.bind(this),this._clear=this._clear.bind(this),this._debug=this._debug.bind(this),this.on=this.on.bind(this),this.emit=this.emit.bind(this),this.destroy=this.destroy.bind(this),this.ready=this.ready.bind(this),this._ready=this._ready.bind(this),this._post=this._post.bind(this),this._posting=!1,this._postNext=this._postNext.bind(this),this._postQueue=[],this._el=t,this._clear(),n?document&&document.addEventListener&&document.addEventListener("message",this.onMessage):window&&window.addEventListener&&window.addEventListener("message",this.onMessage),n?function(t){e?t():i.push(t)}(function(){this._ready()}.bind(this)):this._ready(),this}var e=!1,i=[],n="1"===function(t,e){if(window&&window.location&&window.location.href){e||(e=window.location.href),t=t.replace(/[\[\]]/g,"\\$&");var i=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)").exec(e);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null}return""}("webview");n&&document.addEventListener("message",function(t){!1===e&&"CROSSFRAME_READY"===t.data&&(e=!0,i.forEach(function(t){t()}))}),t.prototype._clear=function(){this._eventlisteners={},this._callbackFns={},this._callbackId=0,this._readyFns=[],this._isReady=!1,n?document&&document.removeEventListener&&document.removeEventListener("message",this.onMessage):window&&window.removeEventListener&&window.removeEventListener("message",this.onMessage)},t.prototype._debug=function(){},t.prototype.onMessage=function(t){if(t.data&&"string"==typeof t.data&&0===t.data.indexOf("CROSSFRAME_MESSAGE")){this._debug("onMessage",t);var e=function(t){return JSON.parse(t,function(t,e){return e&&e.type&&"Error"===e.type?new Error(e.data):e})}(t.data.substr("CROSSFRAME_MESSAGE".length));if("tx"===e.type){var i=function(t,i){var n={type:"cb",args:args=Array.prototype.slice.call(arguments),callbackId:e.callbackId};this.postMessage(n)}.bind(this),n=this._eventlisteners[e.event];n&&n.forEach(function(t){t.call(t,e.data,i)})}else if("cb"===e.type){var o=this._callbackFns[e.callbackId];o&&o.apply(o,e.args)}}},t.prototype.on=function(t,e){return this._eventlisteners[t]=this._eventlisteners[t]||[],this._eventlisteners[t].push(e),this},t.prototype.emit=function(t,e,i){var n=null;"function"==typeof i&&(n=++this._callbackId,this._callbackFns[n]=i);var o={type:"tx",event:t,data:e,callbackId:n};return this.postMessage(o),this},t.prototype.destroy=function(){this._clear()},t.prototype.ready=function(t){this._isReady?t():this._readyFns.push(t)},t.prototype._ready=function(){this._isReady=!0,this._readyFns.forEach(function(t){t()})},t.prototype.postReady=function(t){this._post("CROSSFRAME_READY")},t.prototype.postMessage=function(t){this._post("CROSSFRAME_MESSAGE"+function(t){return JSON.stringify(t,function(t,e){return e instanceof Error?{type:"Error",data:e.message}:e})}(t))},t.prototype._post=function(t){this._debug("_post()",t),this._postQueue.push(t),this._postNext()},t.prototype._postNext=function(){if(!this._posting){var t=this._postQueue.shift();if(void 0!==t){var e;this._el?e=this._el.contentWindow?this._el.contentWindow:this._el:window&&window.parent&&(e=window.parent),e&&(this._posting=!0,e.postMessage(t,"*"),setTimeout(function(){this._posting=!1,this._postNext()}.bind(this),this._opts.delay))}}},"undefined"!=typeof module&&void 0!==module.exports?module.exports=t:window.CrossFrame=t}(),Homey.prototype._init=function(){this._cf=new CrossFrame,this._cf.ready(function(){"complete"===document.readyState?this._onWindowLoad():window.addEventListener("load",this._onWindowLoad.bind(this))}.bind(this))},Homey.prototype._getOrigin=function(t){var e=document.querySelector("head > script[data-origin]");if(e&&(this._origin=e.dataset.origin,this._sdk=parseInt(e.dataset.sdk)),"string"!=typeof this._origin)return t();Homey.loadScript("/manager/"+this._origin+"/js/homey."+this._origin+".js",t)},Homey.prototype._onWindowLoad=function(){this._getOrigin(function(t){if(t)return this.alert(t);"function"==typeof this._onWindowLoadExtended?this._onWindowLoadExtended(function(){window.onHomeyReady&&window.onHomeyReady(this)}.bind(this)):window.onHomeyReady&&window.onHomeyReady(this)}.bind(this))},Homey.prototype._loadI18n=function(t,e){this.getLanguage(function(i,n){if(i)return this.alert(i);window.i18nLanguage=n,t.prefix&&(window.i18nPrefix=t.prefix),t.path&&(window.i18nPath=t.path),Homey.loadScript("/manager/i18n/assets/js/i18n.js",function(t){if(t)return this.alert(t);window.i18nReady(function(){Homey.prototype.__=window.__,translateElement(document.body),this._sdk<2&&(window.Homey=this),e()}.bind(this))}.bind(this))}.bind(this))},Homey.prototype.ready=function(){!0!==this._ready&&(this._ready=!0,this._cf.emit("ready"))},Homey.prototype.alert=function(t,e,i){return this._cf.emit("alert",{text:t,icon:e},i)},Homey.prototype.confirm=function(t,e,i){return this._cf.emit("confirm",{text:t,icon:e},i)},Homey.prototype.getLanguage=function(t){return this._cf.emit("getLanguage",null,t)},Homey.prototype.getDevmode=function(t){return this._cf.emit("getDevmode",null,t)},Homey.prototype.popup=function(t,e,i){return this._cf.emit("popup",{url:t,opts:e},i)},Homey.loadScripts=function(t,e){var i=0,n=t.length;if(n<1)return e();t.forEach(function(t){Homey.loadScript(t,function(t){return t?e(t):++i===n?e():void 0})})},Homey.loadScript=function(t,e){var i=document.createElement("script");i.src=t,i.addEventListener("load",function(){e(null)}),i.addEventListener("error",function(){e(new Error("Could not get script: "+t))}),document.head.appendChild(i)},Homey.loadStyle=function(t,e){var i=document.createElement("link");i.type="text/css",i.rel="stylesheet",i.href=t,i.addEventListener("load",function(){e(null)}),i.addEventListener("error",function(){e(new Error("Could not get stylesheet: "+t))}),document.head.appendChild(i)},new Homey;